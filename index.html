<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bảng số động</title>

<style>
body{
  font-family: monospace;
  background:#0f172a;
  color:white;
  padding:20px;
}

h2{
  text-align:center;
}

.controls{
  margin-bottom:15px;
}

input, button{
  padding:8px;
  border-radius:6px;
  border:none;
  margin-right:5px;
}

button{
  cursor:pointer;
  background:#38bdf8;
  color:black;
  font-weight:bold;
}

.grid{
  display:grid;
  grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
  gap:6px;
}

.cell{
  padding:8px;
  text-align:center;
  border-radius:6px;
  background:#1e293b;
  transition:0.2s;
}

.cell.highlight{
  background:#facc15;
  color:#000;
  font-weight:bold;
}

.cell:hover{
  transform:scale(1.1);
}
</style>
</head>

<body>

<h2>Bảng số động</h2>

<div class="controls">
  <label>Chọn số chữ số:</label>
  <input type="number" id="digitCount" min="1" max="6" value="3">
  <button onclick="generateGrid()">Tạo bảng</button>
</div>

<input type="text" id="inputNumbers" 
placeholder="Nhập số cách nhau bằng dấu cách"
style="width:100%;margin-bottom:15px;">

<div class="grid" id="grid"></div>

<script>

const DATA_URL = "https://tomato-delicate-zebra-533.mypinata.cloud/ipfs/bafkreicpkddnxu3oqvshjx2e235lllo7sjkkawjxghnxkvv4s6egmjdnri";

let ipfsNumberSet = new Set();
let currentDigits = 4; // file của bạn là 4 chữ số

const grid = document.getElementById("grid");
const input = document.getElementById("inputNumbers");
const digitInput = document.getElementById("digitCount");

async function loadIPFS() {
  try {
    const response = await fetch(DATA_URL);
    const text = await response.text();

    const numbers = text
      .replace(/"/g, "") // bỏ dấu ngoặc kép
      .split(",")        // tách bằng dấu phẩy
      .map(n => n.trim())
      .filter(n => n !== "");

    ipfsNumberSet = new Set(numbers);

    console.log("Loaded:", ipfsNumberSet.size, "numbers");

  } catch(err) {
    console.error("Lỗi tải IPFS:", err);
  }
}

function generateGrid(){

  grid.innerHTML = "";
  currentDigits = parseInt(digitInput.value);

  const max = Math.pow(10, currentDigits) - 1;

  for(let i=0;i<=max;i++){

    const numStr = i.toString().padStart(currentDigits,"0");

    const div = document.createElement("div");
    div.className="cell";
    div.textContent = numStr;

    if(ipfsNumberSet.has(numStr)){
      div.classList.add("highlight");
    }

    grid.appendChild(div);
  }
}

input.addEventListener("input", () => {

  const userSet = new Set(
    input.value
      .split(/[\s,]+/)
      .map(n => n.trim())
      .filter(n => n !== "")
  );

  document.querySelectorAll(".cell").forEach(cell => {

    const numStr = cell.textContent;

    cell.classList.remove("highlight");

    if(ipfsNumberSet.has(numStr) || userSet.has(numStr)){
      cell.classList.add("highlight");
    }

  });

});

loadIPFS().then(generateGrid);

</script>
</body>
</html>
